<!DOCTYPE html>
<html lang="en"><head>
<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/tabby.min.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.353">

  <meta name="author" content="Chris Hanretty">
  <title>An introduction to MRP with an application to the SES</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="logo.css">
  <link href="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="vertical_strip.png" data-background-position="top" data-background-repeat="repeat-x" data-background-size="contain" class="quarto-title-block center">
  <h1 class="title">An introduction to MRP with an application to the SES</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Chris Hanretty 
</div>
</div>
</div>

</section>
<section>
<section id="premises" class="title-slide slide level1 center">
<h1>Premises</h1>

</section>
<section id="about-you" class="slide level2">
<h2>About you</h2>
<ul>
<li>You’re a social scientist who works with election studies (🇬🇧; 🏴󠁧󠁢󠁳󠁣󠁴󠁿; 🏴󠁧󠁢󠁷󠁬󠁳󠁿; 🏴󠁧󠁢󠁮󠁩󠁲󠁿)</li>
<li>You have used multilevel or random intercept models for limited (binary or categorical) dependent variables</li>
<li>You use R (😊󠁧󠁢) or Stata (😐)</li>
<li>You are aware of census data;</li>
<li>You are aware of Bayesian methods</li>
</ul>
</section>
<section id="objectives-for-today" class="slide level2">
<h2>Objectives for today</h2>
<ul>
<li>To understand what multilevel regression and post-stratification (MRP) is;</li>
<li>To know when MRP works well and when it works poorly;</li>
<li>To understand how a post-stratification frame is constructed</li>
<li>To be able to estimate a model and post-stratify predictions</li>
<li>To know how to incorporate uncertainty into these predictions</li>
</ul>
</section>
<section id="materials" class="slide level2">
<h2>Materials</h2>
<ul>
<li>The materials for this workshop are available at <a href="github.com/chrishanretty/ses_mrp_workshop">https://github.com/chrishanretty/ses_mrp_workshop</a></li>
<li>This includes:
<ul>
<li>these slides</li>
<li>a post-stratification frame for Scottish Parliamentary Constituencies</li>
<li>A cut-down version of the post-2021 election Scottish Election Study data</li>
</ul></li>
<li>This does not include:
<ul>
<li>post-stratification frames for any other jurisdiction</li>
</ul></li>
</ul>
</section>
<section id="section" class="slide level2 center">
<h2></h2>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Overall approach</strong></p>
</div>
<div class="callout-content">
<p>MRP is not complicated. It is a <strong>footer</strong>, but <strong>dinna fash</strong>.</p>
</div>
</div>
</div>
</section></section>
<section>
<section id="about-mrp" class="title-slide slide level1 center">
<h1>About MRP</h1>

</section>
<section id="origins" class="slide level2">
<h2>Origins</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="index_files/desolapool.jpg"></p>
<figcaption>Ithiel de Sola Pool (b. 1917, d.&nbsp;1984)</figcaption>
</figure>
</div>
</div><div class="column" style="width:60%;">
<ul>
<li>Early attempts by the Simulmatic Corporation to forecast US presidential elections (1960)</li>
<li>Fictionalized in the thriller novel <em>The 480</em> (1964)</li>
<li>Key idea: large national surveys allow inferences to be drawn about the behaviours of different voter blocks</li>
</ul>
</div>
</div>
</section>
<section id="modern-treatments" class="slide level2">
<h2>Modern treatments</h2>
<ul>
<li>The best modern treatment is (depending on taste)
<ul>
<li>Park, David K, Andrew Gelman, and Joseph Bafumi. 2004. “Bayesian Multilevel Estimation with Poststratification: State-Level Estimates from National Polls”, <em>Political Analysis</em> 12 (4): 375–85.</li>
<li>Lax, Jeffrey R, and Justin H Phillips. 2009. “How Should We Estimate Public Opinion in the States?” <em>American Journal of Political Science</em> 53 (1): 107–21.</li>
</ul></li>
</ul>
</section>
<section id="what-changed" class="slide level2">
<h2>What changed?</h2>
<ul>
<li>Between the 1960 and the 2000s we’ve seen
<ul>
<li>vast increases in computing power</li>
<li>development of Bayesian modelling and multilevel modelling</li>
</ul></li>
<li>MRP is now a mature technology, and new papers tend to focus on marginal improvements which deal with better modelling or better ways to deal with post-stratification</li>
<li>MRP remains computationally intensive (model runs of up to several hours)</li>
</ul>
</section>
<section id="the-multilevel-element" class="slide level2">
<h2>The multilevel element</h2>
<ul>
<li>In studies of electoral behaviour: survey respondents are individuals (level 1) nested in electoral districts (level 2)</li>
<li>These electoral districts have effects on the people in them (context matters)</li>
<li>In MRP models, these effects are modelled as <strong>random intercepts</strong></li>
</ul>
</section>
<section id="why-random-intercepts" class="slide level2">
<h2>Why random intercepts?</h2>
<ul>
<li>Our predictions are more accurate because we’ve reduced variance (at the cost of bias)</li>
<li>We don’t really care about the units <em>per se</em></li>
<li>This approach also extends to demographic groups (education, age, ethnicity, sex), with a few more philosophical qualms</li>
<li>Random intercepts, but you’ll also hear about <em>partial pooling</em> or <em>regularization</em></li>
</ul>
</section>
<section id="the-regression-element" class="slide level2">
<h2>The regression element</h2>
<ul>
<li>Any regression model can be turned into a MRP model</li>
<li>There are some techniques for small area estimation which don’t use regression but instead use tree-based models <span class="citation" data-cites="bisbee2019barp">(<a href="#/references" role="doc-biblioref" onclick="">Bisbee 2019</a>)</span>, but these (i) all use some form of regularization; and (ii) have had mixed success <span class="citation" data-cites="goplerud2023re">(<a href="#/references" role="doc-biblioref" onclick="">Goplerud 2023</a>)</span></li>
<li>Most MRP models are binary or categorical models</li>
<li>Continuous models (e.g., for feeling thermometers) are rare; ordinal or bivariate models are rarer still</li>
</ul>
</section>
<section id="the-post-stratification-element" class="slide level2">
<h2>The post-stratification element</h2>
<ul>
<li>What distinguishes MRP is the idea that we use our models to generate predictions (for discrete types) which we then aggregate</li>
<li>Example: 5,040 voter “types” defined by
<ul>
<li>seven age groups, times</li>
<li>two sexes, times</li>
<li>five educational qualifications, times</li>
<li>72 constituencies</li>
</ul></li>
<li>This requires us to know the <strong>joint distribution</strong> of type-defining attributes</li>
</ul>
</section>
<section id="how-its-usually-applied-1" class="slide level2">
<h2>How it’s usually applied (1)</h2>
<ul>
<li><strong>Number of area level units:</strong> between 4 (Canadian metropolitan areas) and 9,981 (US Census administrative units) with a median value of 50</li>
<li><strong>Sample size:</strong> Median sample size of ~7,500, IQR of ~2,500 to ~55,000</li>
<li><strong>Sample size/areas</strong>: median ratio of 87 respondents/unit</li>
</ul>
<p><strong>Source:</strong> <span class="citation" data-cites="lobo2021how">Lobo (<a href="#/references" role="doc-biblioref" onclick="">2021</a>)</span></p>
</section>
<section id="how-its-usually-applied-2-individual-predictors" class="slide level2">
<h2>How it’s usually applied (2): individual predictors</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Almost always included:</p>
<ul>
<li><strong>Gender:</strong> 92%</li>
<li><strong>Education:</strong> 89%</li>
<li><strong>Age:</strong> 86%</li>
<li><strong>Ethnicity:</strong> 70%</li>
</ul>
</div><div class="column" style="width:50%;">
<p>Sometimes included:</p>
<ul>
<li><strong>Past vote:</strong> 17%</li>
<li><strong>Social grade:</strong> 5%</li>
</ul>
</div>
</div>
</section>
<section id="how-its-usually-applied-3-area-level-predictors" class="slide level2">
<h2>How it’s usually applied (3): Area-level predictors</h2>
<ul>
<li><strong>Median number of area-level predictors</strong> is three (IQR: 2 to 5)</li>
<li>… but this depends heavily on the number of areas included</li>
<li>There is a tension between adding relevant data and over-fitting</li>
<li>… but we should probably be using more area level predictors</li>
</ul>
</section>
<section id="what-works" class="slide level2">
<h2>“What works”</h2>
<ul>
<li>Post-stratification variables include variables that affect survey participation (for non-probability samples)</li>
<li>Modelling includes a large number (up to one for every ten areas) of relevant area level variables <span class="citation" data-cites="hanretty2018comparing">(<a href="#/references" role="doc-biblioref" onclick="">Hanretty, Lauderdale, and Vivyan 2018</a>)</span></li>
<li>Modelled behaviour/opinion strongly connected with individual level characteristics (no opinions on individual MPs or context-specific questions)</li>
</ul>
</section>
<section id="to-what-end" class="slide level2">
<h2>To what end?</h2>
<ul>
<li><strong>In its own right</strong>. It can be valuable to know public opinion.</li>
<li><strong>As a predictor variable</strong>. We may want to know the association between public opinion and legislator behaviour.</li>
<li><strong>As an outcome variable?</strong> I struggle to think of cases where we would model aggregate opinion when we had individual opinion.</li>
</ul>
</section>
<section id="section-1" class="slide level2 center">
<h2></h2>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Let’s pause here for questions before going on to post-stratification frames.</p>
</div>
</div>
</div>
</section></section>
<section>
<section id="post-stratification-frames" class="title-slide slide level1 center">
<h1>Post-stratification frames</h1>

</section>
<section id="post-stratification-frames-1" class="slide level2">
<h2>Post-stratification frames</h2>
<ul>
<li>We need to know how many voters of each different type live in each different area</li>
<li>This involves relying on some other more certain source of data</li>
<li>We can either rely on the Census or some other massive non-probability sample</li>
<li>In the UK, this can mean either the different national censuses, or the Annual Population Survey or Labour Force Survey (n = 320,000 per year)</li>
</ul>
</section>
<section id="common-problems" class="slide level2">
<h2>Common problems</h2>
<ul>
<li>Dissemination sites like <a href="https://www.nomisweb.co.uk/">nomisweb</a> typically give two-way or three-way Census tables, but not four- or five-way Census tables</li>
<li>We want to include individual level variables (past vote) which are not included in Census data</li>
<li>Census variables are released for subgroups (those aged 16-64) rather than the population we are interested in</li>
<li>Census variables are not released for subgroups we are interested in (those who have the vote)</li>
</ul>
</section>
<section id="raking-to-the-rescue" class="slide level2">
<h2>Raking to the rescue</h2>
<ul>
<li>Raking, or iterative proportional fitting, is a way to make joint distributions match marginal distributions</li>
<li>It involves repeatedly multiplying and dividing rows and columns in order to match their marginal distributions</li>
<li>We have to start with some initial joint distribution, which could be from our survey data</li>
</ul>
</section>
<section id="example-of-raking-adapted-from-wikipedia" class="slide level2 smaller">
<h2>Example of raking adapted from Wikipedia</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">NVQ L1</th>
<th style="text-align: center;">NVQ L2</th>
<th style="text-align: center;">NVQ L3</th>
<th style="text-align: center;">NVQ L4+</th>
<th style="text-align: center;">TOTAL</th>
<th style="text-align: center;">TARGET</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">AB</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">100</td>
<td style="text-align: center;">150</td>
</tr>
<tr class="even">
<td style="text-align: center;">C1</td>
<td style="text-align: center;">35</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">100</td>
<td style="text-align: center;">75</td>
<td style="text-align: center;">260</td>
<td style="text-align: center;">300</td>
</tr>
<tr class="odd">
<td style="text-align: center;">C2</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">80</td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">120</td>
<td style="text-align: center;">300</td>
<td style="text-align: center;">400</td>
</tr>
<tr class="even">
<td style="text-align: center;">DE</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">140</td>
<td style="text-align: center;">150</td>
</tr>
<tr class="odd">
<td style="text-align: center;">TOTAL</td>
<td style="text-align: center;">125</td>
<td style="text-align: center;">190</td>
<td style="text-align: center;">230</td>
<td style="text-align: center;">255</td>
<td style="text-align: center;">800</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">TARGET</td>
<td style="text-align: center;">200</td>
<td style="text-align: center;">300</td>
<td style="text-align: center;">400</td>
<td style="text-align: center;">100</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1000</td>
</tr>
</tbody>
</table>
</section>
<section id="example-of-raking-2" class="slide level2 smaller">
<h2>Example of raking (2)</h2>
<table style="width:100%;">
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">NVQ L1</th>
<th style="text-align: center;">NVQ L2</th>
<th style="text-align: center;">NVQ L3</th>
<th style="text-align: center;">NVQ L4+</th>
<th style="text-align: center;">TOTAL</th>
<th style="text-align: center;">TARGET</th>
<th style="text-align: center;"><strong>Multiplier</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">AB</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">100</td>
<td style="text-align: center;">150</td>
<td style="text-align: center;"><strong>1.5</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;">C1</td>
<td style="text-align: center;">35</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">100</td>
<td style="text-align: center;">75</td>
<td style="text-align: center;">260</td>
<td style="text-align: center;">300</td>
<td style="text-align: center;"><strong>1.15</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;">C2</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">80</td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">120</td>
<td style="text-align: center;">300</td>
<td style="text-align: center;">400</td>
<td style="text-align: center;"><strong>1.33</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;">DE</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">140</td>
<td style="text-align: center;">150</td>
<td style="text-align: center;"><strong>1.07</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;">TOTAL</td>
<td style="text-align: center;">125</td>
<td style="text-align: center;">190</td>
<td style="text-align: center;">230</td>
<td style="text-align: center;">255</td>
<td style="text-align: center;">800</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">TARGET</td>
<td style="text-align: center;">200</td>
<td style="text-align: center;">300</td>
<td style="text-align: center;">400</td>
<td style="text-align: center;">100</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1000</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
</section>
<section id="example-of-raking-3" class="slide level2 smaller">
<h2>Example of raking (3)</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">NVQ L1</th>
<th style="text-align: center;">NVQ L2</th>
<th style="text-align: center;">NVQ L3</th>
<th style="text-align: center;">NVQ L4+</th>
<th style="text-align: center;"><strong>Total</strong></th>
<th>Target</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">AB</td>
<td style="text-align: center;">60.00</td>
<td style="text-align: center;">45.00</td>
<td style="text-align: center;">30.00</td>
<td style="text-align: center;">15.00</td>
<td style="text-align: center;"><strong>150.00</strong></td>
<td>150</td>
</tr>
<tr class="even">
<td style="text-align: center;">C1</td>
<td style="text-align: center;">40.38</td>
<td style="text-align: center;">57.69</td>
<td style="text-align: center;">115.38</td>
<td style="text-align: center;">86.54</td>
<td style="text-align: center;"><strong>300.00</strong></td>
<td>300</td>
</tr>
<tr class="odd">
<td style="text-align: center;">C2</td>
<td style="text-align: center;">40.00</td>
<td style="text-align: center;">106.67</td>
<td style="text-align: center;">93.33</td>
<td style="text-align: center;">160.00</td>
<td style="text-align: center;"><strong>400.00</strong></td>
<td>400</td>
</tr>
<tr class="even">
<td style="text-align: center;">DE</td>
<td style="text-align: center;">21.43</td>
<td style="text-align: center;">32.14</td>
<td style="text-align: center;">42.86</td>
<td style="text-align: center;">53.57</td>
<td style="text-align: center;"><strong>150.00</strong></td>
<td>150</td>
</tr>
<tr class="odd">
<td style="text-align: center;">TOTAL</td>
<td style="text-align: center;">161.81</td>
<td style="text-align: center;">241.50</td>
<td style="text-align: center;">281.58</td>
<td style="text-align: center;">315.11</td>
<td style="text-align: center;"><strong>1000.00</strong></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: center;">TARGET</td>
<td style="text-align: center;">200</td>
<td style="text-align: center;">300</td>
<td style="text-align: center;">400</td>
<td style="text-align: center;">100</td>
<td style="text-align: center;"></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="example-of-raking-4" class="slide level2 smaller">
<h2>Example of raking (4)</h2>
<table>
<colgroup>
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 11%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">NVQ L1</th>
<th style="text-align: center;">NVQ L2</th>
<th style="text-align: center;">NVQ L3</th>
<th style="text-align: center;">NVQ L4+</th>
<th style="text-align: center;">Total</th>
<th>Target</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">AB</td>
<td style="text-align: center;">60.00</td>
<td style="text-align: center;">45.00</td>
<td style="text-align: center;">30.00</td>
<td style="text-align: center;">15.00</td>
<td style="text-align: center;">150.00</td>
<td>150</td>
</tr>
<tr class="even">
<td style="text-align: center;">C1</td>
<td style="text-align: center;">40.38</td>
<td style="text-align: center;">57.69</td>
<td style="text-align: center;">115.38</td>
<td style="text-align: center;">86.54</td>
<td style="text-align: center;">300.00</td>
<td>300</td>
</tr>
<tr class="odd">
<td style="text-align: center;">C2</td>
<td style="text-align: center;">40.00</td>
<td style="text-align: center;">106.67</td>
<td style="text-align: center;">93.33</td>
<td style="text-align: center;">160.00</td>
<td style="text-align: center;">400.00</td>
<td>400</td>
</tr>
<tr class="even">
<td style="text-align: center;">DE</td>
<td style="text-align: center;">21.43</td>
<td style="text-align: center;">32.14</td>
<td style="text-align: center;">42.86</td>
<td style="text-align: center;">53.57</td>
<td style="text-align: center;">150.00</td>
<td>150</td>
</tr>
<tr class="odd">
<td style="text-align: center;">TOTAL</td>
<td style="text-align: center;">161.81</td>
<td style="text-align: center;">241.50</td>
<td style="text-align: center;">281.58</td>
<td style="text-align: center;">315.11</td>
<td style="text-align: center;">1000.00</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: center;">TARGET</td>
<td style="text-align: center;">200</td>
<td style="text-align: center;">300</td>
<td style="text-align: center;">400</td>
<td style="text-align: center;">100</td>
<td style="text-align: center;"></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Multiplier</td>
<td style="text-align: center;"><strong>1.23</strong></td>
<td style="text-align: center;"><strong>1.24</strong></td>
<td style="text-align: center;"><strong>1.42</strong></td>
<td style="text-align: center;"><strong>.317</strong></td>
<td style="text-align: center;"></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="in-this-case" class="slide level2">
<h2>In this case…</h2>
<ul>
<li>The <strong>joint distribution</strong> comes from the December 2020 Labour Force Survey / Annual Population Survey micro-data (n = 26,279 in Scotland)</li>
<li>(This is available through the UK Data Archive under a non-commercial use licence)</li>
<li>We use December 2020 because only December releases contain educational data, and because it is the closest wave prior to the 2021 elections</li>
</ul>
</section>
<section id="variables-included" class="slide level2">
<h2>Variables included</h2>
<ul>
<li>We use information on the following variables:
<ul>
<li>Age</li>
<li>Sex</li>
<li>Highest qualifications</li>
<li>Ethnicity</li>
</ul></li>
</ul>
</section>
<section id="categorization" class="slide level2">
<h2>Categorization</h2>
<ul>
<li><strong>Age:</strong> eight categories (16-19, 20-24, 25-29, 30-39, 40-49, 50-64, 65-74, 75+)</li>
<li><strong>Sex:</strong> two categories (male, female)</li>
<li><strong>Qualifications</strong>: seven categories (No qualifications, NVQ1, NVQ2, NVQ3, NVQ4+, other quals., trade apprenticeships)</li>
<li><strong>Ethnicity</strong>: two categories (white, ethnic minority)</li>
</ul>
</section>
<section id="examples-of-qualifications" class="slide level2">
<h2>Examples of qualifications</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>aps <span class="ot">&lt;-</span> aps <span class="sc">|&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>    <span class="fu">mutate</span>(<span class="at">quals =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(HIQUAL15,</span>
<span id="cb1-3"><a href="#cb1-3"></a>                                 <span class="st">"A-level or equivalent"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-4"><a href="#cb1-4"></a>                                 <span class="st">"Access qualifications"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-5"><a href="#cb1-5"></a>                                 <span class="st">"Advanced Welsh Baccalaureate"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-6"><a href="#cb1-6"></a>                                 <span class="st">"Advanced/Progression (14-19) Diploma"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-7"><a href="#cb1-7"></a>                                 <span class="st">"AS-level or equivalent"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-8"><a href="#cb1-8"></a>                                 <span class="st">"Basic skills qualification"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-9"><a href="#cb1-9"></a>                                 <span class="st">"BTEC/SCOTVEC First or General certificate"</span> <span class="ot">=</span> <span class="st">"NVQ2 only"</span>,</span>
<span id="cb1-10"><a href="#cb1-10"></a>                                 <span class="st">"BTEC/SCOTVEC First or General diploma etc"</span> <span class="ot">=</span> <span class="st">"NVQ2 only"</span>,</span>
<span id="cb1-11"><a href="#cb1-11"></a>                                 <span class="st">"City &amp; Guilds Advanced Craft/Part 1"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-12"><a href="#cb1-12"></a>                                 <span class="st">"City &amp; Guilds Craft/Part 2"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-13"><a href="#cb1-13"></a>                                 <span class="st">"City &amp; Guilds foundation/Part 1"</span> <span class="ot">=</span> <span class="st">"NVQ2 only"</span>,</span>
<span id="cb1-14"><a href="#cb1-14"></a>                                 <span class="st">"CSE below grade 1, GCSE below grade C"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-15"><a href="#cb1-15"></a>                                 <span class="st">"Diploma in higher education"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-16"><a href="#cb1-16"></a>                                 <span class="st">"Does not apply"</span> <span class="ot">=</span> <span class="st">"other qualifications (NVQ)"</span>,</span>
<span id="cb1-17"><a href="#cb1-17"></a>                                 <span class="st">"Don?t know"</span> <span class="ot">=</span> <span class="st">"no qualifications (NVQ)"</span>,</span>
<span id="cb1-18"><a href="#cb1-18"></a>                                 <span class="st">"Entry level  Award"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-19"><a href="#cb1-19"></a>                                 <span class="st">"Entry level  Certificate"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-20"><a href="#cb1-20"></a>                                 <span class="st">"Entry level  Diploma"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-21"><a href="#cb1-21"></a>                                 <span class="st">"Entry level qualification"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-22"><a href="#cb1-22"></a>                                 <span class="st">"First degree/foundation degree"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-23"><a href="#cb1-23"></a>                                 <span class="st">"Foundation (14-19) Diploma"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-24"><a href="#cb1-24"></a>                                 <span class="st">"GNVQ/GSVQ advanced"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-25"><a href="#cb1-25"></a>                                 <span class="st">"GNVQ/GSVQ foundation level"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-26"><a href="#cb1-26"></a>                                 <span class="st">"GNVQ/GSVQ intermediate"</span> <span class="ot">=</span> <span class="st">"NVQ2 only"</span>,</span>
<span id="cb1-27"><a href="#cb1-27"></a>                                 <span class="st">"Higher (14-19) Diploma"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-28"><a href="#cb1-28"></a>                                 <span class="st">"Higher degree"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-29"><a href="#cb1-29"></a>                                 <span class="st">"HNC/HND/BTEC higher etc"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-30"><a href="#cb1-30"></a>                                 <span class="st">"Intermediate Welsh Baccalaureate"</span> <span class="ot">=</span> <span class="st">"NVQ2 only"</span>,</span>
<span id="cb1-31"><a href="#cb1-31"></a>                                 <span class="st">"International Baccalaureate"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-32"><a href="#cb1-32"></a>                                 <span class="st">"Key skills qualification"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-33"><a href="#cb1-33"></a>                                 <span class="st">"Level 1  Award"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-34"><a href="#cb1-34"></a>                                 <span class="st">"Level 1  Certificate"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-35"><a href="#cb1-35"></a>                                 <span class="st">"Level 1  Diploma"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-36"><a href="#cb1-36"></a>                                 <span class="st">"Level 2  Award"</span> <span class="ot">=</span> <span class="st">"NVQ2 only"</span>,</span>
<span id="cb1-37"><a href="#cb1-37"></a>                                 <span class="st">"Level 2  Certificate"</span> <span class="ot">=</span> <span class="st">"NVQ2 only"</span>,</span>
<span id="cb1-38"><a href="#cb1-38"></a>                                 <span class="st">"Level 2  Diploma"</span> <span class="ot">=</span> <span class="st">"NVQ2 only"</span>,</span>
<span id="cb1-39"><a href="#cb1-39"></a>                                 <span class="st">"Level 3 Award"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-40"><a href="#cb1-40"></a>                                 <span class="st">"Level 3 Certificate"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-41"><a href="#cb1-41"></a>                                 <span class="st">"Level 3 Diploma"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-42"><a href="#cb1-42"></a>                                 <span class="st">"Level 4 Award"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-43"><a href="#cb1-43"></a>                                 <span class="st">"Level 4 Certificate"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-44"><a href="#cb1-44"></a>                                 <span class="st">"Level 4 Diploma"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-45"><a href="#cb1-45"></a>                                 <span class="st">"Level 5 Award"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-46"><a href="#cb1-46"></a>                                 <span class="st">"Level 5 Certificate"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-47"><a href="#cb1-47"></a>                                 <span class="st">"Level 5 Diploma"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-48"><a href="#cb1-48"></a>                                 <span class="st">"Level 6 Award"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-49"><a href="#cb1-49"></a>                                 <span class="st">"Level 6 Certificate"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-50"><a href="#cb1-50"></a>                                 <span class="st">"Level 6 Diploma"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-51"><a href="#cb1-51"></a>                                 <span class="st">"Level 7 Award"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-52"><a href="#cb1-52"></a>                                 <span class="st">"Level 7 Certificate"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-53"><a href="#cb1-53"></a>                                 <span class="st">"Level 7 Diploma"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-54"><a href="#cb1-54"></a>                                 <span class="st">"Level 8 Award"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-55"><a href="#cb1-55"></a>                                 <span class="st">"Level 8 Certificate"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-56"><a href="#cb1-56"></a>                                 <span class="st">"Level 8 Diploma"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-57"><a href="#cb1-57"></a>                                 <span class="st">"No answer"</span> <span class="ot">=</span> <span class="st">"no qualifications (NVQ)"</span>,</span>
<span id="cb1-58"><a href="#cb1-58"></a>                                 <span class="st">"No qualifications"</span> <span class="ot">=</span> <span class="st">"no qualifications (NVQ)"</span>,</span>
<span id="cb1-59"><a href="#cb1-59"></a>                                 <span class="st">"Nursing etc"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-60"><a href="#cb1-60"></a>                                 <span class="st">"NVQ level 1 or equivalent"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-61"><a href="#cb1-61"></a>                                 <span class="st">"NVQ level 2 or equivalent"</span> <span class="ot">=</span> <span class="st">"NVQ2 only"</span>,</span>
<span id="cb1-62"><a href="#cb1-62"></a>                                 <span class="st">"NVQ level 3"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-63"><a href="#cb1-63"></a>                                 <span class="st">"NVQ level 4"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-64"><a href="#cb1-64"></a>                                 <span class="st">"NVQ level 5"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-65"><a href="#cb1-65"></a>                                 <span class="st">"O-level, GCSE grade A*-C or equivalent"</span> <span class="ot">=</span> <span class="st">"NVQ2 only"</span>,</span>
<span id="cb1-66"><a href="#cb1-66"></a>                                 <span class="st">"OND/ONC/BTEC/SCOTVEC National etc"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-67"><a href="#cb1-67"></a>                                 <span class="st">"Other degree"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-68"><a href="#cb1-68"></a>                                 <span class="st">"Other higher education below degree"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-69"><a href="#cb1-69"></a>                                 <span class="st">"Other qualification"</span> <span class="ot">=</span> <span class="st">"other qualifications (NVQ)"</span>,</span>
<span id="cb1-70"><a href="#cb1-70"></a>                                 <span class="st">"RSA advanced diploma"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-71"><a href="#cb1-71"></a>                                 <span class="st">"RSA diploma"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-72"><a href="#cb1-72"></a>                                 <span class="st">"RSA higher diploma"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-73"><a href="#cb1-73"></a>                                 <span class="st">"RSA other"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-74"><a href="#cb1-74"></a>                                 <span class="st">"SCE higher or equivalent"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-75"><a href="#cb1-75"></a>                                 <span class="st">"Scottish 6 year certificate/CSYS"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-76"><a href="#cb1-76"></a>                                 <span class="st">"Scottish Baccalaureate"</span> <span class="ot">=</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb1-77"><a href="#cb1-77"></a>                                 <span class="st">"Scottish National below level 3"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-78"><a href="#cb1-78"></a>                                 <span class="st">"Scottish National Level 3"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-79"><a href="#cb1-79"></a>                                 <span class="st">"Scottish National Level 4"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-80"><a href="#cb1-80"></a>                                 <span class="st">"Scottish National Level 5"</span> <span class="ot">=</span> <span class="st">"NVQ2 only"</span>,</span>
<span id="cb1-81"><a href="#cb1-81"></a>                                 <span class="st">"SCOTVEC modules"</span> <span class="ot">=</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb1-82"><a href="#cb1-82"></a>                                 <span class="st">"Teaching foundation stage"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-83"><a href="#cb1-83"></a>                                 <span class="st">"Teaching further education"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-84"><a href="#cb1-84"></a>                                 <span class="st">"Teaching level not stated"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-85"><a href="#cb1-85"></a>                                 <span class="st">"Teaching primary education"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-86"><a href="#cb1-86"></a>                                 <span class="st">"Teaching secondary education"</span> <span class="ot">=</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb1-87"><a href="#cb1-87"></a>                                 <span class="st">"Trade apprenticeship"</span> <span class="ot">=</span> <span class="st">"Trade Apprenticeships"</span>,</span>
<span id="cb1-88"><a href="#cb1-88"></a>                                 <span class="st">"YT/YTP certificate"</span> <span class="ot">=</span> <span class="st">"NVQ2 only"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="marginal-distributions" class="slide level2">
<h2>Marginal distributions</h2>
<ul>
<li>For <strong>age</strong> and <strong>sex</strong>, we use marginal distributions from National Records of Scotland</li>
<li>They provide <a href="https://www.nrscotland.gov.uk/statistics-and-data/statistics/statistics-by-theme/population/population-estimates/2011-based-special-area-population-estimates/spc-population-estimates">population estimates broken down by sex and single year of age</a> for each Scottish Parliament Constituency (SPC)</li>
<li>For <strong>education</strong> and <strong>ethnicity</strong>, we use information from the APS/LFS (March 2021 editions)</li>
<li>There is one wrinkle for <strong>education</strong>: the LFS is only interested in those 16-64.</li>
<li>We take 2005-vintage data for those 50-65 and bring it forward to cover those 65+</li>
</ul>
</section>
<section id="raking-in-r" class="slide level2">
<h2>Raking in R</h2>
<ul>
<li>In order to rake in R, I use the <code>anesrake</code> package</li>
<li>As the name suggests, this is made for ANES data, but works fine with other data</li>
<li>Other packages (<code>ipfr</code>, <code>mipfp</code>) are available</li>
</ul>
</section>
<section id="raking-in-r-2" class="slide level2">
<h2>Raking in R (2)</h2>
<ul>
<li>Suppose we have variables in <code>anes</code> called <code>agecats</code> and <code>married</code></li>
<li>We want to match the following targets:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>married_tgt <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">4</span>, <span class="do">## logical false = not married </span></span>
<span id="cb2-2"><a href="#cb2-2"></a>                 .<span class="dv">6</span>) <span class="do">## logical true = married</span></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a>age_tgt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age1824"</span> <span class="ot">=</span> .<span class="dv">1</span>,</span>
<span id="cb2-5"><a href="#cb2-5"></a>             <span class="st">"age2534"</span> <span class="ot">=</span> .<span class="dv">15</span>,</span>
<span id="cb2-6"><a href="#cb2-6"></a>             <span class="st">"age3544"</span> <span class="ot">=</span> .<span class="dv">17</span>,</span>
<span id="cb2-7"><a href="#cb2-7"></a>             <span class="st">"age4554"</span> <span class="ot">=</span> .<span class="dv">23</span>,</span>
<span id="cb2-8"><a href="#cb2-8"></a>             <span class="st">"age5564"</span> <span class="ot">=</span> .<span class="dv">22</span>,</span>
<span id="cb2-9"><a href="#cb2-9"></a>             <span class="st">"age6599"</span> <span class="ot">=</span> .<span class="dv">13</span>)</span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a>tgts <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"married"</span> <span class="ot">=</span> married_tgt,</span>
<span id="cb2-12"><a href="#cb2-12"></a>             <span class="st">"agecats"</span> <span class="ot">=</span> age_tgt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="raking-in-r-3" class="slide level2">
<h2>Raking in R (3)</h2>
<ul>
<li>We’d have to tidy our data to make sure it matches how our targets are specified</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">library</span>(anesrake)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="fu">data</span>(<span class="st">"anes04"</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a>anes04 <span class="ot">&lt;-</span> anes04 <span class="sc">|&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="fu">mutate</span>(<span class="at">caseid  =</span> <span class="fu">seq_len</span>(<span class="fu">n</span>()),</span>
<span id="cb3-6"><a href="#cb3-6"></a>           <span class="at">agecats =</span> <span class="fu">cut</span>(age,</span>
<span id="cb3-7"><a href="#cb3-7"></a>                         <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>,<span class="dv">35</span>,<span class="dv">45</span>,<span class="dv">55</span>,<span class="dv">65</span>,<span class="dv">99</span>),</span>
<span id="cb3-8"><a href="#cb3-8"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"age1824"</span>, <span class="st">"age2534"</span>, <span class="st">"age3544"</span>,</span>
<span id="cb3-9"><a href="#cb3-9"></a>                                    <span class="st">"age4554"</span>, <span class="st">"age5564"</span>, <span class="st">"age6599"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="raking-in-r-4" class="slide level2">
<h2>Raking in R (4)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>res <span class="ot">&lt;-</span> <span class="fu">anesrake</span>(tgts,</span>
<span id="cb4-2"><a href="#cb4-2"></a>                anes04,</span>
<span id="cb4-3"><a href="#cb4-3"></a>                <span class="at">caseid =</span> anes04<span class="sc">$</span>caseid,</span>
<span id="cb4-4"><a href="#cb4-4"></a>                <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Raking...Iteration 1"
[1] "Current iteration changed total weights by 303.931933308375"
[1] "Raking...Iteration 2"
[1] "Current iteration changed total weights by 50.8760710934304"
[1] "Raking...Iteration 3"
[1] "Current iteration changed total weights by 2.45181318049929"
[1] "Raking...Iteration 4"
[1] "Current iteration changed total weights by 0.115529921587497"
[1] "Raking...Iteration 5"
[1] "Current iteration changed total weights by 0.00543798477855262"
[1] "Raking...Iteration 6"
[1] "Current iteration changed total weights by 0.000255952672060356"
[1] "Raking...Iteration 7"
[1] "Current iteration changed total weights by 1.20470391882233e-05"
[1] "Raking...Iteration 8"
[1] "Current iteration changed total weights by 5.67023318742699e-07"
[1] "Raking...Iteration 9"
[1] "Current iteration changed total weights by 2.66883061206258e-08"
[1] "Raking...Iteration 10"
[1] "Current iteration changed total weights by 1.25607590995003e-09"
[1] "Raking...Iteration 11"
[1] "Current iteration changed total weights by 5.92315085867767e-11"
[1] "Raking...Iteration 12"
[1] "Current iteration changed total weights by 2.76700884427328e-12"
[1] "Raking...Iteration 13"
[1] "Current iteration changed total weights by 2.07389660999979e-13"
[1] "Raking...Iteration 14"
[1] "Current iteration changed total weights by 1.23678844943242e-13"
[1] "Raking...Iteration 15"
[1] "Current iteration changed total weights by 1.2356782264078e-13"
[1] "Raking converged in 15 iterations"</code></pre>
</div>
</div>
</section>
<section id="raking-in-r-5" class="slide level2">
<h2>Raking in R (5)</h2>
<p>We’ll need to get access to these weights…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>caseweights <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">caseid =</span> res<span class="sc">$</span>caseid,</span>
<span id="cb6-2"><a href="#cb6-2"></a>                          <span class="at">w8 =</span> res<span class="sc">$</span>weightvec)</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a>anes04 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(anes04,</span>
<span id="cb6-5"><a href="#cb6-5"></a>                    caseweights,</span>
<span id="cb6-6"><a href="#cb6-6"></a>                    <span class="at">by =</span> <span class="st">"caseid"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="raking-a-post-stratification-frame" class="slide level2">
<h2>Raking a post-stratification frame</h2>
<ul>
<li>Raking a post-stratification frame is no different in principle</li>
<li>In practice, we’re raking on more variables, and raking one constituency at a time</li>
<li>IPF is pretty robust, so we don’t have to worry about problems</li>
<li>… except where you have structural zeros</li>
</ul>
</section>
<section id="adding-on-political-variables" class="slide level2">
<h2>Adding on political variables</h2>
<ul>
<li>I haven’t said anything about political variables for post-stratification</li>
<li>I run an MRP model of list vote choice using the SES post-election wave</li>
<li>I then adjust these MRP predictions to match known results using a “logit shift” <span class="citation" data-cites="rosenman2023recalibration">(<a href="#/references" role="doc-biblioref" onclick="">Rosenman, McCartan, and Olivella 2023</a>)</span></li>
<li>I add these predictions on to the post-stratification frame and adjust</li>
</ul>
</section>
<section id="the-resulting-post-stratification-frame" class="slide level2">
<h2>The resulting post-stratification frame</h2>
<ul>
<li><strong>Age:</strong> eight categories (16-19, 20-24, 25-29, 30-39, 40-49, 50-64, 65-74, 75+)</li>
<li><strong>Sex:</strong> two categories (male, female)</li>
<li><strong>Qualifications</strong>: seven categories (No qualifications, NVQ1, NVQ2, NVQ3, NVQ4+, other quals., trade apprenticeships)</li>
<li><strong>Ethnicity</strong>: two categories (white, ethnic minority)</li>
<li><strong>2021 list vote</strong>: seven categories (Con., DNV, Green, Lab, LibDem, Other, SNP)</li>
</ul>
</section>
<section id="some-summary-statistics" class="slide level2">
<h2>Some summary statistics…</h2>
<ul>
<li>There are fewer rows (80,297) than unique combinations of the variables</li>
<li>Not all combinations are possible; some have trace presence (16-19 years old with degrees)</li>
<li>The weights are expressed as proportions of the 16+ population (i.e., VAP)</li>
<li>The average (mean) weight is 1 in 1,100</li>
<li>The maximum weight is just under 5% (white women in Edinburgh Central aged 30-39 w/ NVQ4+ who didn’t vote)</li>
</ul>
</section>
<section id="section-2" class="slide level2 center">
<h2></h2>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Let’s pause here for questions before going on to the application.</p>
</div>
</div>
</div>
</section></section>
<section>
<section id="the-application" class="title-slide slide level1 center">
<h1>The application</h1>

</section>
<section id="directory-structure" class="slide level2">
<h2>Directory structure</h2>
<pre><code>├── data
│&nbsp;&nbsp; ├── 2021_results_over_vap.csv
│&nbsp;&nbsp; ├── psf.csv
│&nbsp;&nbsp; └── ses21_postelection_subset.csv
├── R
│&nbsp;&nbsp; ├── 001_tidy_data.R
│&nbsp;&nbsp; ├── 002_mrp_with_glmer.R
│&nbsp;&nbsp; └── 003_mrp_with_brms.R
├── README.md
├── slides
│&nbsp;&nbsp; ├── index_files
│&nbsp;&nbsp; ├── index.html
│&nbsp;&nbsp; └── index.qmd
└── working
    └── tidy_ind_data.rds
</code></pre>
</section>
<section id="results_over_vap.csv" class="slide level2">
<h2><code>2021_results_over_vap.csv</code></h2>
<p>A comma separated values file containing information on the list votes of selected parties (and those who did not vote) expressed as a proportion of the voting age population.</p>
<p>This is the constituency-level analogue of the “past_list_vote” variable in the post-stratification frame.</p>
</section>
<section id="ses21_postelection_subset.csv" class="slide level2 smaller">
<h2><code>ses21_postelection_subset.csv</code></h2>
<p>A comma separated values file with 3,442 observations on the following variables:</p>
<ul>
<li><strong>age</strong>: an integer</li>
<li><strong>birthSex</strong>: a character variable with two unique values</li>
<li><strong>profile_education_level</strong>: a character variable with 20 unique values</li>
<li><strong>ethnicity_new</strong>: a character variable with 17 unique values</li>
<li><strong>ethnicity_new1617</strong>: as above, but for a small number of top-up respondents</li>
<li><strong>w2_voted</strong>: whether or not the respondent voted in the 2021 SP election</li>
<li><strong>w2_vb15</strong>: the party for which the respondent voted</li>
<li><strong>w2_uk10</strong>: the respondent’s view on Scottish independence (1 = ‘Yes’; 2 = ‘No’; 3 = ‘Would not vote’; 4 = ‘Don’t know’)</li>
</ul>
</section>
<section id="psf.csv" class="slide level2">
<h2><code>psf.csv</code></h2>
<p>A comma separated values file; a post-stratification frame, as discussed above.</p>
</section>
<section id="r-packages-used" class="slide level2">
<h2>R packages used</h2>
<p>I’ll be using the following packages:</p>
<ul>
<li><code>tidyverse</code>: the general utility package</li>
<li><code>here</code>: for consistently dealing with file locations</li>
<li><code>lme4</code>: for frequentist multilevel models</li>
<li><code>brms</code>: for Bayesian models of all kinds</li>
</ul>
</section>
<section id="tidying-the-data" class="slide level2">
<h2>Tidying the data</h2>
<div class="sourceCode" id="cb8" data-startfrom="1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">library</span>(here)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a>here<span class="sc">::</span><span class="fu">i_am</span>(<span class="st">"R/001_tidy_data.R"</span>)</span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a>ind <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"ses21_postelection_subset.csv"</span>))</span>
<span id="cb8-7"><a href="#cb8-7"></a>ps <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"psf.csv"</span>))</span>
<span id="cb8-8"><a href="#cb8-8"></a></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="do">### Convert post-stratification variables to factors</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="do">### This will help checking</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>ps <span class="ot">&lt;-</span> ps <span class="sc">|&gt;</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>    <span class="fu">mutate_at</span>(<span class="fu">vars</span>(age, sex, quals, ethnicity, past_list_vote, geogcode),</span>
<span id="cb8-13"><a href="#cb8-13"></a>              factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="making-categories-match-age" class="slide level2">
<h2>Making categories match: age</h2>
<div class="sourceCode" id="cb9" data-startfrom="16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 15;"><span id="cb9-16"><a href="#cb9-16"></a>age_breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">15</span>, <span class="dv">19</span>, <span class="dv">24</span>,</span>
<span id="cb9-17"><a href="#cb9-17"></a>                <span class="dv">29</span>, <span class="dv">39</span>, <span class="dv">49</span>, <span class="dv">64</span>, <span class="dv">74</span>, <span class="cn">Inf</span>)</span>
<span id="cb9-18"><a href="#cb9-18"></a></span>
<span id="cb9-19"><a href="#cb9-19"></a>age_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0-15"</span>, <span class="st">"16-19"</span>,</span>
<span id="cb9-20"><a href="#cb9-20"></a>                <span class="st">"20-24"</span>, <span class="st">"25-29"</span>,</span>
<span id="cb9-21"><a href="#cb9-21"></a>                <span class="st">"30-39"</span>, <span class="st">"40-49"</span>,</span>
<span id="cb9-22"><a href="#cb9-22"></a>                <span class="st">"50-64"</span>, <span class="st">"65-74"</span>,</span>
<span id="cb9-23"><a href="#cb9-23"></a>                <span class="st">"75+"</span>)</span>
<span id="cb9-24"><a href="#cb9-24"></a></span>
<span id="cb9-25"><a href="#cb9-25"></a>ind <span class="ot">&lt;-</span> ind <span class="sc">|&gt;</span></span>
<span id="cb9-26"><a href="#cb9-26"></a>    <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">cut</span>(age,</span>
<span id="cb9-27"><a href="#cb9-27"></a>                     age_breaks,</span>
<span id="cb9-28"><a href="#cb9-28"></a>                     age_labels))</span>
<span id="cb9-29"><a href="#cb9-29"></a></span>
<span id="cb9-30"><a href="#cb9-30"></a>a <span class="ot">&lt;-</span> <span class="fu">nrow</span>(ind)</span>
<span id="cb9-31"><a href="#cb9-31"></a>ind <span class="ot">&lt;-</span> ind <span class="sc">|&gt;</span></span>
<span id="cb9-32"><a href="#cb9-32"></a>    <span class="fu">filter</span>(age <span class="sc">!=</span> <span class="st">"0-15"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-33"><a href="#cb9-33"></a>    <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">factor</span>(age, <span class="at">levels =</span> age_labels[<span class="sc">-</span><span class="dv">1</span>]))</span>
<span id="cb9-34"><a href="#cb9-34"></a>b <span class="ot">&lt;-</span> <span class="fu">nrow</span>(ind)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="making-categories-match-education" class="slide level2">
<h2>Making categories match: education</h2>
<div class="sourceCode" id="cb10" data-startfrom="53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 52;"><span id="cb10-53"><a href="#cb10-53"></a>ind <span class="ot">&lt;-</span> ind <span class="sc">|&gt;</span></span>
<span id="cb10-54"><a href="#cb10-54"></a>    <span class="fu">mutate</span>(<span class="at">quals =</span> <span class="fu">case_when</span>(profile_education_level <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"University or CNAA higher degree (e.g. M.Sc, Ph.D)"</span>,</span>
<span id="cb10-55"><a href="#cb10-55"></a>                                          <span class="st">"University or CNAA first degree (e.g. BA, B.Sc, B.Ed)"</span>,</span>
<span id="cb10-56"><a href="#cb10-56"></a>                                          <span class="st">"University diploma"</span>,</span>
<span id="cb10-57"><a href="#cb10-57"></a>                                          <span class="st">"Teaching qualification (not degree)"</span>,</span>
<span id="cb10-58"><a href="#cb10-58"></a>                                          <span class="st">"Nursing qualification (e.g. SEN, SRN, SCM, RGN)"</span>) <span class="sc">~</span> <span class="st">"NVQ4+"</span>,</span>
<span id="cb10-59"><a href="#cb10-59"></a>                             profile_education_level <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"onc"</span>,</span>
<span id="cb10-60"><a href="#cb10-60"></a>                                          <span class="st">"ONC"</span>,</span>
<span id="cb10-61"><a href="#cb10-61"></a>                                          <span class="st">"GCE A level or Higher Certificate"</span>,</span>
<span id="cb10-62"><a href="#cb10-62"></a>                                          <span class="st">"Scottish Higher Certificate"</span>) <span class="sc">~</span> <span class="st">"NVQ3 only"</span>,</span>
<span id="cb10-63"><a href="#cb10-63"></a>                             profile_education_level <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Recognised trade apprenticeship completed"</span>) <span class="sc">~</span> <span class="st">"Trade Apprenticeships"</span>,</span>
<span id="cb10-64"><a href="#cb10-64"></a>                             profile_education_level <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Youth training certificate/skillseekers"</span>,</span>
<span id="cb10-65"><a href="#cb10-65"></a>                                          <span class="st">"City &amp; Guilds certificate - advanced"</span>,</span>
<span id="cb10-66"><a href="#cb10-66"></a>                                          <span class="st">"Scottish Ordinary/ Lower Certificate"</span>,</span>
<span id="cb10-67"><a href="#cb10-67"></a>                                          <span class="st">"CSE grade 1, GCE O level, GCSE, School Certificate"</span>) <span class="sc">~</span></span>
<span id="cb10-68"><a href="#cb10-68"></a>                                 <span class="st">"NVQ2 only"</span>,</span>
<span id="cb10-69"><a href="#cb10-69"></a>                             profile_education_level <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Clerical and commercial"</span>,</span>
<span id="cb10-70"><a href="#cb10-70"></a>                                          <span class="st">"City &amp; Guilds certificate"</span>,</span>
<span id="cb10-71"><a href="#cb10-71"></a>                                          <span class="st">"CSE grades 2-5"</span>) <span class="sc">~</span> <span class="st">"NVQ1 only"</span>,</span>
<span id="cb10-72"><a href="#cb10-72"></a>                             profile_education_level <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"No formal qualifications"</span>,</span>
<span id="cb10-73"><a href="#cb10-73"></a>                                          <span class="st">"Don't know"</span>,</span>
<span id="cb10-74"><a href="#cb10-74"></a>                                          <span class="st">"Prefer not to say"</span>) <span class="sc">~</span> <span class="st">"no qualifications (NVQ)"</span>,</span>
<span id="cb10-75"><a href="#cb10-75"></a>                             profile_education_level <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Other technical, professional or higher qualification"</span>) <span class="sc">~</span></span>
<span id="cb10-76"><a href="#cb10-76"></a>                                 <span class="st">"other qualifications (NVQ)"</span>,</span>
<span id="cb10-77"><a href="#cb10-77"></a>                             <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>))</span>
<span id="cb10-78"><a href="#cb10-78"></a></span>
<span id="cb10-79"><a href="#cb10-79"></a>ind <span class="ot">&lt;-</span> ind <span class="sc">|&gt;</span></span>
<span id="cb10-80"><a href="#cb10-80"></a>    <span class="fu">mutate</span>(<span class="at">quals =</span> <span class="fu">factor</span>(quals,</span>
<span id="cb10-81"><a href="#cb10-81"></a>                          <span class="at">levels =</span> <span class="fu">levels</span>(ps<span class="sc">$</span>quals)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="notes-on-tidying" class="slide level2">
<h2>Notes on tidying</h2>
<ul>
<li>We drop missing observations; we could use single-shot imputation with <code>Amelia</code></li>
<li>We drop from 3,442 observations to 2,841 observations (mostly due to missingness on the outcome)</li>
<li>We make some assumptions about ethnicity and past vote behaviour at some points
<ul>
<li>“Don’t knows” are “white” and “did not vote” respectively</li>
</ul></li>
<li>Your thoughts on this welcome!</li>
</ul>
</section>
<section id="modelling-the-model-with-glmer" class="slide level2 smaller">
<h2>Modelling the model with <code>glmer</code></h2>
<div class="sourceCode" id="cb11" data-startfrom="1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">library</span>(here)</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="fu">library</span>(lme4)</span>
<span id="cb11-4"><a href="#cb11-4"></a></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="fu">set.seed</span>(<span class="dv">3082</span>)</span>
<span id="cb11-6"><a href="#cb11-6"></a>here<span class="sc">::</span><span class="fu">i_am</span>(<span class="st">"R/002_mrp_with_glmer.R"</span>)</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="do">### Read in the post-stratification frame</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>ps <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,</span>
<span id="cb11-10"><a href="#cb11-10"></a>                         <span class="st">"psf.csv"</span>))</span>
<span id="cb11-11"><a href="#cb11-11"></a></span>
<span id="cb11-12"><a href="#cb11-12"></a>ps <span class="ot">&lt;-</span> ps <span class="sc">|&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13"></a>    <span class="fu">mutate</span>(<span class="at">ethnicity =</span> <span class="fu">coalesce</span>(ethnicity, <span class="st">"white"</span>))</span>
<span id="cb11-14"><a href="#cb11-14"></a></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="do">### Check these are all factors</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>ps <span class="ot">&lt;-</span> ps <span class="sc">|&gt;</span></span>
<span id="cb11-17"><a href="#cb11-17"></a>    <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">c</span>(geogcode, age, sex, quals, ethnicity,</span>
<span id="cb11-18"><a href="#cb11-18"></a>                     past_list_vote)),</span>
<span id="cb11-19"><a href="#cb11-19"></a>              factor)</span>
<span id="cb11-20"><a href="#cb11-20"></a></span>
<span id="cb11-21"><a href="#cb11-21"></a><span class="do">### Read in the individual data</span></span>
<span id="cb11-22"><a href="#cb11-22"></a>ind <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"working"</span>,</span>
<span id="cb11-23"><a href="#cb11-23"></a>                           <span class="st">"tidy_ind_data.rds"</span>))</span>
<span id="cb11-24"><a href="#cb11-24"></a></span>
<span id="cb11-25"><a href="#cb11-25"></a><span class="do">### Read in the aggregate-level predictors</span></span>
<span id="cb11-26"><a href="#cb11-26"></a>agg <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"2021_results_over_vap.csv"</span>))</span>
<span id="cb11-27"><a href="#cb11-27"></a></span>
<span id="cb11-28"><a href="#cb11-28"></a><span class="do">### Merge on to both sets of data</span></span>
<span id="cb11-29"><a href="#cb11-29"></a>ind <span class="ot">&lt;-</span> <span class="fu">left_join</span>(ind, agg, <span class="at">by =</span> <span class="st">"geogcode"</span>)</span>
<span id="cb11-30"><a href="#cb11-30"></a>ps <span class="ot">&lt;-</span> <span class="fu">left_join</span>(ps, agg, <span class="at">by =</span> <span class="st">"geogcode"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="modelling-the-model-with-glmer-2" class="slide level2">
<h2>Modelling the model with <code>glmer</code> (2)</h2>
<div class="sourceCode" id="cb12" data-startfrom="34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 33;"><span id="cb12-34"><a href="#cb12-34"></a>f <span class="ot">&lt;-</span> dv <span class="sc">~</span> (<span class="dv">1</span><span class="sc">|</span>geogcode) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>age) <span class="sc">+</span> sex <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>quals) <span class="sc">+</span> ethnicity <span class="sc">+</span></span>
<span id="cb12-35"><a href="#cb12-35"></a>    (<span class="dv">1</span><span class="sc">|</span>past_list_vote) <span class="sc">+</span> SNP <span class="sc">+</span> Lab</span>
<span id="cb12-36"><a href="#cb12-36"></a></span>
<span id="cb12-37"><a href="#cb12-37"></a>mod <span class="ot">&lt;-</span> <span class="fu">glmer</span>(f, <span class="at">data =</span> ind, <span class="at">family =</span> binomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ChatGPT translation:</p>
<pre><code>xtmelogit dv sex ethnicity SNP Lab || geogcode: || age: || quals: || past_list_vote:, ///
    covariance(unstructured) family(binomial) link(logit)</code></pre>
</section>
<section id="post-stratifying" class="slide level2">
<h2>Post-stratifying</h2>
<div class="sourceCode" id="cb14" data-startfrom="40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 39;"><span id="cb14-40"><a href="#cb14-40"></a>ps<span class="sc">$</span>mu <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> ps)</span>
<span id="cb14-41"><a href="#cb14-41"></a>ps<span class="sc">$</span>predprob <span class="ot">&lt;-</span> <span class="fu">plogis</span>(ps<span class="sc">$</span>mu)</span>
<span id="cb14-42"><a href="#cb14-42"></a></span>
<span id="cb14-43"><a href="#cb14-43"></a><span class="do">### Aggregate up to constituency</span></span>
<span id="cb14-44"><a href="#cb14-44"></a>consty <span class="ot">&lt;-</span> ps <span class="sc">|&gt;</span></span>
<span id="cb14-45"><a href="#cb14-45"></a>    <span class="fu">group_by</span>(geogcode, ScotPcon2014) <span class="sc">|&gt;</span></span>
<span id="cb14-46"><a href="#cb14-46"></a>    <span class="fu">summarize</span>(<span class="at">mean_indy_support =</span> <span class="fu">weighted.mean</span>(predprob, w8),</span>
<span id="cb14-47"><a href="#cb14-47"></a>              <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="outputs" class="slide level2">
<h2>Outputs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>consty <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_indy_support)) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>  geogcode  ScotPcon2014            mean_indy_support
  &lt;chr&gt;     &lt;chr&gt;                               &lt;dbl&gt;
1 S16000099 Dundee City West                    0.532
2 S16000093 Cumbernauld and Kilsyth             0.529
3 S16000091 Coatbridge and Chryston             0.523
4 S16000122 Glasgow Southside                   0.522
5 S16000123 Greenock and Inverclyde             0.510
6 S16000119 Glasgow Pollok                      0.510</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>consty <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_indy_support)) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>  geogcode  ScotPcon2014                       mean_indy_support
  &lt;chr&gt;     &lt;chr&gt;                                          &lt;dbl&gt;
1 S16000111 Ettrick, Roxburgh and Berwickshire             0.313
2 S16000135 Orkney Islands                                 0.337
3 S16000097 Dumfriesshire                                  0.338
4 S16000078 Aberdeenshire West                             0.347
5 S16000114 Galloway and West Dumfries                     0.373
6 S16000081 Angus North and Mearns                         0.385</code></pre>
</section>
<section id="whats-wrong-with-this" class="slide level2">
<h2>What’s wrong with this?</h2>
<ul>
<li>There’s nothing wrong with this model; it does the job, and quickly</li>
<li>However, we have no measures of uncertainty, and</li>
<li>… adding another constituency-level predictor introduces problems of perfect separation <span class="citation" data-cites="zorn2005solution">(<a href="#/references" role="doc-biblioref" onclick="">Zorn 2005</a>)</span></li>
<li>Both of these problems can be dealt with using Bayesian models</li>
</ul>
</section>
<section id="modelling-with-brms" class="slide level2">
<h2>Modelling with <code>brms</code></h2>
<div class="sourceCode" id="cb19" data-startfrom="38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 37;"><span id="cb19-38"><a href="#cb19-38"></a>mod <span class="ot">&lt;-</span> <span class="fu">brm</span>(f,</span>
<span id="cb19-39"><a href="#cb19-39"></a>           <span class="at">family =</span> bernoulli,</span>
<span id="cb19-40"><a href="#cb19-40"></a>           <span class="at">data =</span> ind,</span>
<span id="cb19-41"><a href="#cb19-41"></a>           <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb19-42"><a href="#cb19-42"></a>           <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb19-43"><a href="#cb19-43"></a>           <span class="at">prior =</span> <span class="fu">set_prior</span>(<span class="st">"normal(0, 1)"</span>, <span class="at">class =</span> <span class="st">"b"</span>),</span>
<span id="cb19-44"><a href="#cb19-44"></a>           <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>),</span>
<span id="cb19-45"><a href="#cb19-45"></a>           <span class="at">warmup =</span> <span class="dv">2000</span>,</span>
<span id="cb19-46"><a href="#cb19-46"></a>           <span class="at">iter =</span> <span class="dv">2250</span></span>
<span id="cb19-47"><a href="#cb19-47"></a>           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="post-stratifying-1" class="slide level2 smaller">
<h2>Post-stratifying</h2>
<div class="sourceCode" id="cb20" data-startfrom="50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 49;"><span id="cb20-50"><a href="#cb20-50"></a>preds <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(mod,</span>
<span id="cb20-51"><a href="#cb20-51"></a>                <span class="at">newdata =</span> ps,</span>
<span id="cb20-52"><a href="#cb20-52"></a>                <span class="at">ndraws =</span> <span class="dv">100</span>)</span>
<span id="cb20-53"><a href="#cb20-53"></a></span>
<span id="cb20-54"><a href="#cb20-54"></a><span class="do">### transpose them so that the predictions are on the columns</span></span>
<span id="cb20-55"><a href="#cb20-55"></a>preds <span class="ot">&lt;-</span> <span class="fu">t</span>(preds)</span>
<span id="cb20-56"><a href="#cb20-56"></a>preds <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(preds)</span>
<span id="cb20-57"><a href="#cb20-57"></a></span>
<span id="cb20-58"><a href="#cb20-58"></a>ps <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ps, preds)</span>
<span id="cb20-59"><a href="#cb20-59"></a></span>
<span id="cb20-60"><a href="#cb20-60"></a>ps <span class="ot">&lt;-</span> ps <span class="sc">|&gt;</span></span>
<span id="cb20-61"><a href="#cb20-61"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"V"</span>),</span>
<span id="cb20-62"><a href="#cb20-62"></a>                 <span class="at">names_to =</span> <span class="st">"iter"</span>,</span>
<span id="cb20-63"><a href="#cb20-63"></a>                 <span class="at">values_to =</span> <span class="st">"predprob"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="aggregating" class="slide level2 smaller">
<h2>Aggregating</h2>
<div class="sourceCode" id="cb21" data-startfrom="64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 63;"><span id="cb21-64"><a href="#cb21-64"></a></span>
<span id="cb21-65"><a href="#cb21-65"></a>consty <span class="ot">&lt;-</span> ps <span class="sc">|&gt;</span></span>
<span id="cb21-66"><a href="#cb21-66"></a>    <span class="fu">group_by</span>(geogcode, ScotPcon2014, iter) <span class="sc">|&gt;</span></span>
<span id="cb21-67"><a href="#cb21-67"></a>    <span class="fu">summarize</span>(<span class="at">indy_support =</span> <span class="fu">weighted.mean</span>(predprob,</span>
<span id="cb21-68"><a href="#cb21-68"></a>                                           w8),</span>
<span id="cb21-69"><a href="#cb21-69"></a>              <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-70"><a href="#cb21-70"></a>    <span class="fu">group_by</span>(geogcode, ScotPcon2014) <span class="sc">|&gt;</span></span>
<span id="cb21-71"><a href="#cb21-71"></a>    <span class="fu">summarize</span>(<span class="at">indy_support_mean =</span> <span class="fu">mean</span>(indy_support),</span>
<span id="cb21-72"><a href="#cb21-72"></a>              <span class="at">indy_support_lo =</span> <span class="fu">quantile</span>(indy_support, <span class="fl">0.05</span>),</span>
<span id="cb21-73"><a href="#cb21-73"></a>              <span class="at">indy_support_hi =</span> <span class="fu">quantile</span>(indy_support, <span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="results" class="slide level2">
<h2>Results</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>consty <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_indy_support)) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>ScotPcon2014       indy_support_mean indy_support_lo indy_support_hi
&lt;chr&gt;                          &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
Dundee City West               0.535           0.483           0.593
Glasgow Southside              0.525           0.467           0.580
Cumbernauld and K…             0.517           0.453           0.552
Coatbridge and Ch…             0.515           0.478           0.558
Glasgow Pollok                 0.512           0.467           0.585
Glasgow Kelvin                 0.507           0.443           0.579</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>consty <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>    <span class="fu">arrange</span>(mean_indy_support) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>ScotPcon2014       indy_support_mean indy_support_lo indy_support_hi
&lt;chr&gt;                          &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
Ettrick, Roxburgh…             0.320           0.271           0.358
Dumfriesshire                  0.341           0.301           0.381
Orkney Islands                 0.346           0.302           0.387
Aberdeenshire West             0.352           0.312           0.386
Galloway and West…             0.375           0.336           0.404
Angus North and M…             0.385           0.327           0.420
</code></pre>
</section>
<section id="things-to-note" class="slide level2">
<h2>Things to note</h2>
<ul>
<li>We can include interactions, but it’s best to include them manually</li>
<li>Memory requirements can become more demanding with more complicated post-stratification frames</li>
<li>I haven’t addressed categorical outcomes</li>
<li>This code will work for any dichotomous or continuous outcome (or any outcome that can be treated as such)</li>
</ul>
</section>
<section id="section-3" class="slide level2">
<h2></h2>

<img data-src="mrp_printer.png" class="r-stretch"></section>
<section id="section-4" class="slide level2 center">
<h2></h2>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Let’s have a discussion. Can you envisage using MRP? How could MRP be useful to you?</p>
</div>
</div>
</div>
</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>
<div class="footer footer-default">

</div>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-bisbee2019barp" class="csl-entry" role="listitem">
Bisbee, James. 2019. <span>“<span>BARP</span>: Improving <span>Mister P</span> Using <span>B</span>ayesian Additive Regression Trees.”</span> <em>American Political Science Review</em> 113 (4): 1060–65.
</div>
<div id="ref-goplerud2023re" class="csl-entry" role="listitem">
Goplerud, Max. 2023. <span>“Re-Evaluating Machine Learning for <span>MRP</span> Given the Comparable Performance of (Deep) Hierarchical Models.”</span> <em>American Political Science Review</em>, 1–8.
</div>
<div id="ref-hanretty2018comparing" class="csl-entry" role="listitem">
Hanretty, Chris, Benjamin E Lauderdale, and Nick Vivyan. 2018. <span>“Comparing Strategies for Estimating Constituency Opinion from National Survey Samples.”</span> <em>Political Science Research and Methods</em> 6 (3): 571–91.
</div>
<div id="ref-lax2009should" class="csl-entry" role="listitem">
Lax, Jeffrey R, and Justin H Phillips. 2009. <span>“How Should We Estimate Public Opinion in the States?”</span> <em>American Journal of Political Science</em> 53 (1): 107–21.
</div>
<div id="ref-lobo2021how" class="csl-entry" role="listitem">
Lobo, Ben. 2021. <span>“How Can We Improve Multilevel Regression and Post-Stratification (MRP) Estimate Accuracy?”</span> PhD thesis, Royal Holloway, University of London.
</div>
<div id="ref-park2004bayesian" class="csl-entry" role="listitem">
Park, David K, Andrew Gelman, and Joseph Bafumi. 2004. <span>“Bayesian Multilevel Estimation with Poststratification: State-Level Estimates from National Polls.”</span> <em>Political Analysis</em> 12 (4): 375–85.
</div>
<div id="ref-rosenman2023recalibration" class="csl-entry" role="listitem">
Rosenman, Evan TR, Cory McCartan, and Santiago Olivella. 2023. <span>“Recalibration of Predicted Probabilities Using the <span>‘Logit Shift’</span>: Why Does It Work, and When Can It Be Expected to Work Well?”</span> <em>Political Analysis</em>, 1–11.
</div>
<div id="ref-zorn2005solution" class="csl-entry" role="listitem">
Zorn, Christopher. 2005. <span>“A Solution to Separation in Binary Response Models.”</span> <em>Political Analysis</em> 13 (2): 157–70.
</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="index_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="index_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="index_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="index_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="index_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="index_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>